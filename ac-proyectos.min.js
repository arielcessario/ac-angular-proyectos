(function(){"use strict";var scripts=document.getElementsByTagName("script");var currentScriptPath=scripts[scripts.length-1].src;if(currentScriptPath.length==0){currentScriptPath=window.installPath+"/ac-angular-proyectos/includes/ac-proyectos.php"}angular.module("acProyectos",[]).factory("ProyectService",ProyectService).service("ProyectVars",ProyectVars).factory("DonationService",DonationService).service("DonationVars",DonationVars);ProyectService.$inject=["$http","ProyectVars","$cacheFactory","AcUtils"];function ProyectService($http,ProyectVars,$cacheFactory,AcUtils){var service={};var url=currentScriptPath.replace("ac-proyectos.js","/includes/ac-proyectos.php");service.get=get;service.getByParams=getByParams;service.getMasVendidos=getMasVendidos;service.getByCategoria=getByCategoria;service.create=create;service.update=update;service.remove=remove;service.goToPagina=goToPagina;service.next=next;service.prev=prev;return service;function get(callback){var urlGet=url+"?function=getProyectos";var $httpDefaultCache=$cacheFactory.get("$http");var cachedData=[];if($httpDefaultCache.get(urlGet)!=undefined){if(ProyectVars.clearCache){$httpDefaultCache.remove(urlGet)}else{cachedData=$httpDefaultCache.get(urlGet);callback(cachedData);return}}return $http.get(urlGet,{cache:true}).success(function(data){$httpDefaultCache.put(urlGet,data);ProyectVars.clearCache=false;ProyectVars.paginas=data.length%ProyectVars.paginacion==0?parseInt(data.length/ProyectVars.paginacion):parseInt(data.length/ProyectVars.paginacion)+1;callback(data)}).error(function(data){callback(data);ProyectVars.clearCache=false})}function getByParams(params,values,exact_match,callback){get(function(data){AcUtils.getByParams(params,values,exact_match,data,callback)})}function getMasVendidos(callback){get(function(data){var response=data.sort(function(a,b){return b.vendidos-a.vendidos});callback(response.slice(0,8))})}function getByCategoria(categoria_id,callback){var proyectos=[];get(function(data){if(data==undefined||data.length==0)return callback(proyectos);data.forEach(function(proyecto){if(proyecto===undefined||proyecto.categorias===undefined||proyecto.categorias.length==0)return callback(proyectos);if(categoria_id==proyecto.categorias[0].categoria_id)proyectos.push(proyecto)});return callback(proyectos)})}function remove(proyecto_id,callback){return $http.post(url,{"function":"removeProyecto",proyecto_id:proyecto_id}).success(function(data){if(data!=="false"){ProyectVars.clearCache=true;callback(data)}}).error(function(data){callback(data)})}function create(proyecto,callback){return $http.post(url,{"function":"createProyecto",proyecto:JSON.stringify(proyecto)}).success(function(data){ProyectVars.clearCache=true;callback(data)}).error(function(data){ProyectVars.clearCache=true;callback(data)})}function update(proyecto,callback){return $http.post(url,{"function":"updateProyecto",proyecto:JSON.stringify(proyecto)}).success(function(data){ProyectVars.clearCache=true;callback(data)}).error(function(data){callback(data)})}function goToPagina(pagina){if(isNaN(pagina)||pagina<1){ProyectVars.pagina=1;return ProyectVars}if(pagina>ProyectVars.paginas){ProyectVars.pagina=ProyectVars.paginas;return ProyectVars}ProyectVars.pagina=pagina-1;ProyectVars.start=ProyectVars.pagina*ProyectVars.paginacion;return ProyectVars}function next(){if(ProyectVars.pagina+1>ProyectVars.paginas){return ProyectVars}ProyectVars.start=ProyectVars.pagina*ProyectVars.paginacion;ProyectVars.pagina=ProyectVars.pagina+1;return ProyectVars}function prev(){if(ProyectVars.pagina-2<0){return ProyectVars}ProyectVars.start=(ProyectVars.pagina-2)*ProyectVars.paginacion;ProyectVars.pagina=ProyectVars.pagina-1;return ProyectVars}}ProyectVars.$inject=[];function ProyectVars(){this.paginas=1;this.pagina=1;this.paginacion=10;this.start=0;this.clearCache=true}DonationService.$inject=["$http","DonationVars","$cacheFactory","AcUtils"];function DonationService($http,DonationVars,$cacheFactory,AcUtils){var service={};var url=currentScriptPath.replace("ac-proyectos.js","/includes/ac-proyectos.php");service.get=get;service.getByParams=getByParams;service.create=create;service.update=update;service.remove=remove;service.goToPagina=goToPagina;service.next=next;service.prev=prev;return service;function get(callback){var urlGet=url+"?function=getCategorias";var $httpDefaultCache=$cacheFactory.get("$http");var cachedData=[];if($httpDefaultCache.get(urlGet)!=undefined){if(DonationVars.clearCache){$httpDefaultCache.remove(urlGet)}else{cachedData=$httpDefaultCache.get(urlGet);callback(cachedData);return}}return $http.get(urlGet,{cache:true}).success(function(data){$httpDefaultCache.put(urlGet,data);DonationVars.clearCache=false;DonationVars.paginas=data.length%DonationVars.paginacion==0?parseInt(data.length/DonationVars.paginacion):parseInt(data.length/DonationVars.paginacion)+1;callback(data)}).error(function(data){callback(data);DonationVars.clearCache=false})}function getByParams(params,values,exact_match,callback){get(function(data){AcUtils.getByParams(params,values,exact_match,data,callback)})}function remove(categoria_id,callback){return $http.post(url,{"function":"removeCategoria",categoria_id:categoria_id}).success(function(data){if(data!=="false"){DonationVars.clearCache=true;callback(data)}}).error(function(data){callback(data)})}function create(categoria,callback){return $http.post(url,{"function":"createCategoria",categoria:JSON.stringify(categoria)}).success(function(data){DonationVars.clearCache=true;callback(data)}).error(function(data){DonationVars.clearCache=true;callback(data)})}function update(categoria,callback){return $http.post(url,{"function":"updateCategoria",categoria:JSON.stringify(categoria)}).success(function(data){DonationVars.clearCache=true;callback(data)}).error(function(data){callback(data)})}function goToPagina(pagina){if(isNaN(pagina)||pagina<1){DonationVars.pagina=1;return DonationVars}if(pagina>DonationVars.paginas){DonationVars.pagina=DonationVars.paginas;return DonationVars}DonationVars.pagina=pagina-1;DonationVars.start=DonationVars.pagina*DonationVars.paginacion;return DonationVars}function next(){if(DonationVars.pagina+1>DonationVars.paginas){return DonationVars}DonationVars.start=DonationVars.pagina*DonationVars.paginacion;DonationVars.pagina=DonationVars.pagina+1;return DonationVars}function prev(){if(DonationVars.pagina-2<0){return DonationVars}DonationVars.start=(DonationVars.pagina-2)*DonationVars.paginacion;DonationVars.pagina=DonationVars.pagina-1;return DonationVars}}DonationVars.$inject=[];function DonationVars(){this.paginas=1;this.pagina=1;this.paginacion=10;this.start=0;this.clearCache=true}CartService.$inject=["$http","CartVars","$cacheFactory","AcUtils"];function CartService($http,CartVars,$cacheFactory,AcUtils){var service={};var url=currentScriptPath.replace("ac-proyectos.js","/includes/ac-proyectos.php");service.get=get;service.getByParams=getByParams;service.create=create;service.update=update;service.remove=remove;service.addToCart=addToCart;service.updateProyectInCart=updateProyectInCart;service.removeFromCart=removeFromCart;service.reloadLastCart=reloadLastCart;service.checkOut=checkOut;service.goToPagina=goToPagina;service.next=next;service.prev=prev;return service;function addToCart(carrito_id,proyecto,callback){return $http.post(url,{"function":"createCarritoDetalle",carrito_id:carrito_id,carrito_detalle:JSON.stringify(proyecto)}).success(function(data){if(data!=-1){CartVars.carrito.push(data);CartVars.broadcast()}CartVars.clearCache=true;callback(data)}).error(function(data){CartVars.clearCache=true;callback(data)})}function updateProyectInCart(carrito_detalle,callback){return $http.post(url,{"function":"updateCarritoDetalle",carrito_detalle:JSON.stringify(carrito_detalle)}).success(function(data){if(data!=-1){var index=0;for(var i=0;i<CartVars.carrito.length;i++){if(CartVars.carrito[i].carrito_detalle_id==carrito_detalle.carrito_detalle_id){index=i}}CartVars.carrito[index]={};CartVars.carrito[index]=carrito_detalle;CartVars.broadcast()}CartVars.clearCache=true;callback(data)}).error(function(data){CartVars.clearCache=true;callback(data)})}function removeFromCart(carrito_detalle_id,callback){return $http.post(url,{"function":"removeCarritoDetalle",carrito_detalle_id:JSON.stringify(carrito_detalle_id)}).success(function(data){if(data!=-1){var index=0;for(var i=0;i<CartVars.carrito.length;i++){if(CartVars.carrito[i].carrito_detalle_id==carrito_detalle.carrito_detalle_id){index=i}}CartVars.splice(index,1);CartVars.broadcast()}CartVars.clearCache=true;callback(data)}).error(function(data){CartVars.clearCache=true;callback(data)})}function reloadLastCart(usuario_id,callback){get(usuario_id,function(data){AcUtils.getByParams("status",0,true,data,callback)})}function checkOut(carrito_id,callback){update({carrito_id:carrito_id,status:1},function(data){callback(data)})}function get(usuario_id,callback){var urlGet=url+"?function=getCarritos&usuario_id="+usuario_id;var $httpDefaultCache=$cacheFactory.get("$http");var cachedData=[];if($httpDefaultCache.get(urlGet)!=undefined){if(CartVars.clearCache){$httpDefaultCache.remove(urlGet)}else{cachedData=$httpDefaultCache.get(urlGet);callback(cachedData);return}}return $http.get(urlGet,{cache:true}).success(function(data){$httpDefaultCache.put(urlGet+usuario_id,data);CartVars.clearCache=false;CartVars.paginas=data.length%CartVars.paginacion==0?parseInt(data.length/CartVars.paginacion):parseInt(data.length/CartVars.paginacion)+1;callback(data)}).error(function(data){callback(data);CartVars.clearCache=false})}function getByParams(params,values,exact_match,usuario_id,callback){get(usuario_id,function(data){AcUtils.getByParams(params,values,exact_match,data,callback)})}function remove(carrito_id,callback){return $http.post(url,{"function":"removeCarrito",carrito_id:carrito_id}).success(function(data){if(data!=="false"){CartVars.clearCache=true;callback(data)}}).error(function(data){callback(data)})}function create(carrito,callback){return $http.post(url,{"function":"createCarrito",carrito:JSON.stringify(carrito)}).success(function(data){CartVars.clearCache=true;callback(data)}).error(function(data){CartVars.clearCache=true;callback(data)})}function update(carrito,callback){return $http.post(url,{"function":"updateCarrito",carrito:JSON.stringify(carrito)}).success(function(data){CartVars.clearCache=true;callback(data)}).error(function(data){callback(data)})}function goToPagina(pagina){if(isNaN(pagina)||pagina<1){CartVars.pagina=1;return CartVars}if(pagina>CartVars.paginas){CartVars.pagina=CartVars.paginas;return CartVars}CartVars.pagina=pagina-1;CartVars.start=CartVars.pagina*CartVars.paginacion;return CartVars}function next(){if(CartVars.pagina+1>CartVars.paginas){return CartVars}CartVars.start=CartVars.pagina*CartVars.paginacion;CartVars.pagina=CartVars.pagina+1;return CartVars}function prev(){if(CartVars.pagina-2<0){return CartVars}CartVars.start=(CartVars.pagina-2)*CartVars.paginacion;CartVars.pagina=CartVars.pagina-1;return CartVars}}CartVars.$inject=["$rootScope"];function CartVars($rootScope){this.paginas=1;this.pagina=1;this.paginacion=10;this.start=0;this.carrito=[];this.carrito_cantidad_proyectos=function(){var cantidad=0;for(var i=0;i<this.carrito.length;i++){cantidad=cantidad+this.carrito[i].cantidad}return cantidad};this.carrito_total=function(){var precio=0;for(var i=0;i<this.carrito.length;i++){precio=precio+this.carrito[i].cantidad*this.carrito[i].precio_unitario}return precio};this.clearCache=true;this.broadcast=function(){$rootScope.$broadcast("CartVars")};this.listen=function(callback){$rootScope.$on("CartVars",callback)}}})();